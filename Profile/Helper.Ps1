
importProcess  $MyInvocation.MyCommand.Name.trim('.ps1') -start
function Get-Help
{
    [CmdletBinding(DefaultParameterSetName = 'AllUsersView')]
    param(
        [Parameter(Position = 0, ValueFromPipelineByPropertyName = $true)]
        [string]$Name,

        [Parameter(ParameterSetName = 'DetailedView', Mandatory = $true)]
        [switch]$Detailed,

        [Parameter(ParameterSetName = 'AllUsersView')]
        [switch]$Full,

        [Parameter(ParameterSetName = 'Examples', Mandatory = $true)]
        [switch]$Examples,

        [Parameter(ParameterSetName = 'Parameters', Mandatory = $true)]
        [string[]]$Parameter,

        [Parameter(ParameterSetName = 'Online', Mandatory = $true)]
        [switch]$Online,

    # –ù–∞—à–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        [switch]$Colorized,
        [switch]$Interactive,
        [switch]$ShowRelated,
        [switch]$ExportHTML
    )

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —É–±–∏—Ä–∞–µ–º –∏—Ö –∏–∑ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
    $ourParams = @{ }
    foreach ($param in @('Colorized', 'Interactive', 'ShowRelated', 'ExportHTML'))
    {
        if ( $PSBoundParameters.ContainsKey($param))
        {
            $ourParams[$param] = $PSBoundParameters[$param]
            $PSBoundParameters.Remove($param)
        }
    }

    # –í—ã–∑—ã–≤–∞–µ–º –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô Get-Help
    $helpResult = Microsoft.PowerShell.Core\Get-Help @PSBoundParameters


    # –¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º –¥–µ–ª–∞—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —á—Ç–æ —É–≥–æ–¥–Ω–æ!
    if ($ourParams.Colorized -or $true)
    {
        # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–∞–µ–º —Ü–≤–µ—Ç–∞
        $helpResult | Format-ColorizedHelp -ShowRelated:$ourParams.ShowRelated
    }
    elseif ($ourParams.Interactive)
    {
        Show-InteractiveHelp -HelpObject $helpResult
    }
    elseif ($ourParams.ExportHTML)
    {
        Export-HelpToHTML -HelpObject $helpResult
    }
    else
    {
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
        $helpResult
    }
}

function Format-ColorizedHelp
{
    param(
        [Parameter(ValueFromPipeline)]
        $HelpObject,
        [switch]$ShowRelated
    )

    process {
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
        $helpText = $HelpObject | Out-String

        # –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏

        $patterns = @{
            # –°–µ–∫—Ü–∏–∏ (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤)
            Sections = @{
                Pattern = '(?m)^(NAME|PowerShell|–ò–ú–Ø|SYNOPSIS|–ö–†–ê–¢–ö–û–ï –û–ü–ò–°–ê–ù–ò–ï|SYNTAX|–°–ò–ù–¢–ê–ö–°–ò–°|DESCRIPTION|–û–ü–ò–°–ê–ù–ò–ï|PARAMETERS|–ü–ê–†–ê–ú–ï–¢–†–´|EXAMPLES?|–ü–†–ò–ú–ï–†–´?|INPUTS|–í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï|OUTPUTS|–í–´–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï|NOTES|–ü–†–ò–ú–ï–ß–ê–ù–ò–Ø|RELATED LINKS|–°–í–Ø–ó–ê–ù–ù–´–ï –°–°–´–õ–ö–ò)(.*)$'
                Style = @{
                    FC = "Material_Pink"
                    Effects = @('Bold', 'Underline')
                }
            }
            # –ò–º—è –∫–æ–º–∞–Ω–¥—ã
            CommandName = @{
                Pattern = "(?<![a-zA-Z-])($([regex]::Escape($HelpObject.Name) ))(?![a-zA-Z-])"
                Style = @{
                    FC = "Material_Yellow"
                    Effects = @('Bold')
                }
            }
            # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
            Parameters = @{
                Pattern = '\B-[a-zA-Z]\w*\b'
                Style = @{ FC = "Material_Cyan" }
            }
            # –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
            Types = @{
                Pattern = '\[([\w\[\]\.]+)\]'
                Style = @{ FC = "Material_Purple"; Effects = @('Italic') }
            }
            # Required, Position –∏ —Ç.–¥.
            Attributes = @{
                Pattern = '\b(Required|Mandatory|Position|ValueFromPipeline|ValueFromPipelineByPropertyName)\b'
                Style = @{ FC = "Material_Orange" }
            }
            # –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            DefaultValues = @{
                Pattern = 'Default value:?\s*(.+)$'
                Style = @{ FC = "Material_Green" }
            }
            # URL –∏ –ø—É—Ç–∏
            Links = @{
                Pattern = 'https?://[^\s]+'
                Style = @{ FC = "SkyBlue"; Effects = @('Underline') }
            }
            # –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
            CodeExamples = @{
                Pattern = '^\s{4,}.+$'  # –°—Ç—Ä–æ–∫–∏ —Å –æ—Ç—Å—Ç—É–ø–æ–º (–æ–±—ã—á–Ω–æ –ø—Ä–∏–º–µ—Ä—ã)
                Style = @{ FC = "Material_Comment"; BC = "#1E1E1E" }
            }
        }

        # –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å—Ç—Ä–æ—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
        $lines = $helpText -split "`n"

        foreach ($line in $lines)
        {
            $processed = $false
            $segments = @()

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω
            foreach ($patternName in $patterns.Keys)
            {
                $pattern = $patterns[$patternName]

                if ($line -match $pattern.Pattern)
                {
                    $processed = $true

                    # –û—Å–æ–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Å–µ–∫—Ü–∏–π
                    if ($patternName -eq 'Sections')
                    {
                        Write-Host ""  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–µ—Ä–µ–¥ —Å–µ–∫—Ü–∏–µ–π
                        wrgb $matches[1] -FC $pattern.Style.FC -Style $pattern.Style.Effects
                        if ($matches[2])
                        {
                            wrgb $matches[2] -FC "White" -newline
                        }
                        else
                        {
                            Write-Host ""
                        }
                        break
                    }
                }
            }

            # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–º
            if (-not $processed)
            {
                # –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫ —Å—Ç—Ä–æ–∫–µ
                $finalLine = $line

                foreach ($patternName in @('Types', 'Parameters', 'CommandName', 'Attributes', 'Links'))
                {
                    $pattern = $patterns[$patternName]
                    $finalLine = [regex]::Replace($finalLine, $pattern.Pattern, {
                        param($match)
                        $fcValue = $pattern.Style.FC
                        $colorValue = if ($fcValue -and $global:RGB -and $global:RGB.ContainsKey($fcValue)) { 
                            $global:RGB[$fcValue] 
                        } else { 
                            if ($fcValue) { $fcValue } else { "White" }
                        }
                        $color = Get-RGBColor $colorValue
                        $reset = $PSStyle.Reset

                        # –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
                        $effects = ""
                        if ($pattern.Style.Effects -contains 'Bold')
                        {
                            $effects += $PSStyle.Bold
                        }
                        if ($pattern.Style.Effects -contains 'Italic')
                        {
                            $effects += $PSStyle.Italic
                        }
                        if ($pattern.Style.Effects -contains 'Underline')
                        {
                            $effects += $PSStyle.Underline
                        }

                        return $effects + $color + $match.Value + $reset
                    })
                }

                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–¥–∞
                if ($line -match '^\s{4,}.+$')
                {
                    wrgb $line -FC "Material_Comment" -BC "#1E1E1E" -newline
                }
                else
                {
                    Write-Host $finalLine
                }
            }
        }

        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if ($ShowRelated)
        {
            Show-RelatedCommands -CommandName $HelpObject.Name
        }
    }
}

function Show-RelatedCommands
{
    param([string]$CommandName)

    Write-Host ""
    wrgb "–°–í–Ø–ó–ê–ù–ù–´–ï –ö–û–ú–ê–ù–î–´" -FC "Material_Pink" -Style @('Bold', 'Underline') -newline

    # –ò—â–µ–º –∫–æ–º–∞–Ω–¥—ã —Å –ø–æ—Ö–æ–∂–∏–º –∏–º–µ–Ω–µ–º –∏–ª–∏ –∏–∑ —Ç–æ–≥–æ –∂–µ –º–æ–¥—É–ª—è
    $command = Get-Command $CommandName -ErrorAction SilentlyContinue
    if ($command -and $command.ModuleName)
    {
        $relatedCommands = Get-Command -Module $command.ModuleName |
                Where-Object {
                    $_.Name -ne $CommandName
                } |
                Select-Object -First 5

        foreach ($related in $relatedCommands)
        {
            wrgb "  ‚Ä¢ " -FC "DarkGray"
            wrgb $related.Name -FC "Material_Cyan"
            wrgb " - " -FC "DarkGray"

            # –ü–æ–ª—É—á–∞–µ–º –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
            $synopsis = (Microsoft.PowerShell.Core\Get-Help $related.Name).Synopsis
            if ($synopsis)
            {
                wrgb ($synopsis -split "`n")[0] -FC "Gray" -newline
            }
            else
            {
                wrgb "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è" -FC "DarkGray" -newline
            }
        }
    }
}

#endregion

#region –î—Ä—É–≥–∏–µ –º–æ—â–Ω—ã–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–∏

# –ü—Ä–∏–º–µ—Ä 2: –ü–µ—Ä–µ—Ö–≤–∞—Ç Get-Process —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
function Get-Process
{
    [CmdletBinding(DefaultParameterSetName = 'Name')]
    param(
        [Parameter(ParameterSetName = 'Name', Position = 0, ValueFromPipelineByPropertyName = $true)]
        [Alias('ProcessName')]
        [string[]]$Name,

        [Parameter(ParameterSetName = 'Id', Mandatory = $true, ValueFromPipelineByPropertyName = $true)]
        [int[]]$Id,

        [Parameter(ParameterSetName = 'InputObject', Mandatory = $true, ValueFromPipeline = $true)]
        [System.Diagnostics.Process[]]$InputObject,

    # –ù–∞—à–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        [switch]$ShowPerformance,
        [switch]$ColorByUsage,
        [switch]$Tree
    )

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    $ourParams = @{
    }
    foreach ($param in @('ShowPerformance', 'ColorByUsage', 'Tree'))
    {
        if ( $PSBoundParameters.ContainsKey($param))
        {
            $ourParams[$param] = $PSBoundParameters[$param]
            $PSBoundParameters.Remove($param)
        }
    }

    # –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π Get-Process
    $processes = Microsoft.PowerShell.Management\Get-Process @PSBoundParameters

    # –£–ª—É—á—à–∞–µ–º –≤—ã–≤–æ–¥
    if ($ourParams.ShowPerformance)
    {
        $processes | Format-ProcessPerformance
    }
    elseif ($ourParams.ColorByUsage)
    {
        $processes | Format-ProcessColored
    }
    elseif ($ourParams.Tree)
    {
        $processes | Format-ProcessTree
    }
    else
    {
        $processes
    }
}

function Format-ProcessColored
{
    param(
        [Parameter(ValueFromPipeline)]
        [System.Diagnostics.Process]$Process
    )

    begin {
        $totalMemory = (Get-CimInstance Win32_ComputerSystem).TotalPhysicalMemory
        wrgb "PID".PadRight(8) -FC "Cyan"
        wrgb "Name".PadRight(25) -FC "Cyan"
        wrgb "CPU(s)".PadRight(10) -FC "Cyan"
        wrgb "Memory(MB)".PadRight(12) -FC "Cyan"
        wrgb "Status" -FC "Cyan" -newline
        wrgb ("-" * 65) -FC "DarkGray" -newline
    }

    process {
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤
        $memoryMB = [math]::Round($Process.WorkingSet64 / 1MB, 2)
        $memoryPercent = ($Process.WorkingSet64 / $totalMemory) * 100

        $cpuColor = "White"
        $memColor = if ($memoryPercent -gt 10)
        {
            "Red"
        }
        elseif ($memoryPercent -gt 5)
        {
            "Yellow"
        }
        else
        {
            "Green"
        }

        wrgb $Process.Id.ToString().PadRight(8) -FC "White"
        wrgb $Process.ProcessName.PadRight(25) -FC "Material_Purple"
        wrgb $Process.CPU.ToString("F2").PadRight(10) -FC $cpuColor
        wrgb $memoryMB.ToString().PadRight(12) -FC $memColor
        wrgb $( if ($Process.Responding)
        {
            "‚úì Running"
        }
        else
        {
            "‚úó Not Responding"
        } ) `
                 -FC $( if ($Process.Responding)
        {
            "LimeGreen"
        }
        else
        {
            "Red"
        } ) -newline
    }
}

# –ü—Ä–∏–º–µ—Ä 3: –£–º–Ω—ã–π Get-ChildItem —Å preview —Ñ–∞–π–ª–æ–≤
function Get-ChildItem
{
    [CmdletBinding(DefaultParameterSetName = 'Items')]
    param(
        [Parameter(Position = 0, ValueFromPipeline = $true, ValueFromPipelineByPropertyName = $true)]
        [string[]]$Path,

        [Parameter(Position = 1)]
        [string]$Filter,

        [string[]]$Include,
        [string[]]$Exclude,
        [switch]$Recurse,
        [switch]$Force,
        [switch]$Name,

    # –ù–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        [switch]$Preview,
        [switch]$ColorByType,
        [switch]$ShowSize,
        [switch]$Git  # –£—á–∏—Ç—ã–≤–∞—Ç—å .gitignore
    )

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    $ourParams = @{
    }
    foreach ($param in @('Preview', 'ColorByType', 'ShowSize', 'Git'))
    {
        if ( $PSBoundParameters.ContainsKey($param))
        {
            $ourParams[$param] = $PSBoundParameters[$param]
            $PSBoundParameters.Remove($param)
        }
    }

    # –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π Get-ChildItem
    $items = Microsoft.PowerShell.Management\Get-ChildItem @PSBoundParameters

    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    if ($ourParams.Preview)
    {
        $items | Show-FilePreview
    }
    elseif ($ourParams.ColorByType)
    {
        $items | Format-ItemsColored
    }
    elseif ($ourParams.Git)
    {
        # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ–≥–ª–∞—Å–Ω–æ .gitignore
        $items | Where-Object {
            -not (Test-GitIgnored $_.FullName)
        }
    }
    else
    {
        $items
    }
}

function Format-ItemsColored
{
    param(
        [Parameter(ValueFromPipeline)]
        $Item
    )

    process {
        $icon = ""
        $color = "White"

        if ($Item.PSIsContainer)
        {
            $icon = "üìÅ"
            $color = "Material_Yellow"
        }
        else
        {
            switch -Wildcard ( $Item.Extension.ToLower())
            {
                ".ps1" {
                    $icon = "‚ö°"; $color = "Material_Blue"
                }
                ".txt" {
                    $icon = "üìÑ"; $color = "White"
                }
                ".log" {
                    $icon = "üìã"; $color =
    "Gray"
                }
                ".json" {
                    $icon = "üîß"; $color = "Material_Green"
                }
                ".xml" {
                    $icon = "üìê"; $color = "Material_Orange"
                }
                ".exe" {
                    $icon = "üöÄ"; $color = "Material_Red"
                }
                ".dll" {
                    $icon = "üì¶"; $color = "Material_Purple"
                }
                ".zip" {
                    $icon = "üóúÔ∏è"; $color = "Material_Cyan"
                }
                ".jpg" {
                    $icon = "üñºÔ∏è"; $color = "Material_Pink"
                }
                ".mp3" {
                    $icon = "üéµ"; $color = "Material_Purple"
                }
                ".mp4" {
                    $icon = "üé¨"; $color = "Material_Red"
                }
                default {
                    $icon = "üìÑ"; $color = "White"
                }
            }
        }

        wrgb "$icon " -FC $color
        wrgb $Item.Name -FC $color

        if (-not $Item.PSIsContainer)
        {
            $size = switch ($Item.Length)
            {
                {
                    $_ -gt 1GB
                } {
                    " ({0:N2} GB)" -f ($_ / 1GB)
                }
                {
                    $_ -gt 1MB
                } {
                    " ({0:N2} MB)" -f ($_ / 1MB)
                }
                {
                    $_ -gt 1KB
                } {
                    " ({0:N2} KB)" -f ($_ / 1KB)
                }
                default {
                    " ($_ bytes)"
                }
            }
            wrgb $size -FC "DarkGray"
        }

        Write-Host ""
    }
}

#endregion

#region –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ Proxy –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

function New-CommandProxy
{
    <#
    .SYNOPSIS
        –°–æ–∑–¥–∞–µ—Ç proxy-—Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ª—é–±–æ–π –∫–æ–º–∞–Ω–¥—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏

    .DESCRIPTION
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é-–æ–±–µ—Ä—Ç–∫—É, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤—ã –∫–æ–º–∞–Ω–¥—ã,
        –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

    .EXAMPLE
        New-CommandProxy -Command Get-Service -AddParameters @{
            ColorStatus = @{ Type = 'switch'; Help = '–¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–æ–≤' }
        } -OutputScript MyGetService.ps1
    #>
    [CmdletBinding()]
    param(
        [Parameter(Mandatory)]
        [string]$Command,

        [hashtable]$AddParameters = @{
    },

        [scriptblock]$PreProcess,
        [scriptblock]$PostProcess,

        [string]$OutputScript,
        [switch]$PassThru
    )

    # –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
    $cmd = Get-Command $Command -ErrorAction Stop
    $metadata = [System.Management.Automation.CommandMetadata]::new($cmd)

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–∫—Å–∏
    $proxyScript = [System.Management.Automation.ProxyCommand]::Create($metadata)

    # –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç
    if ($AddParameters.Count -gt 0)
    {
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        $paramBlock = ""
        foreach ($paramName in $AddParameters.Keys)
        {
            $param = $AddParameters[$paramName]
            $paramBlock += "`n        [$( $param.Type )]`$$paramName,"
        }

        # –í—Å—Ç–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ
        $proxyScript = $proxyScript -replace '(\[CmdletBinding[^\]]*\]\s*param\s*\([^)]*)', "`$1,$paramBlock"
    }

    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à—É –ª–æ–≥–∏–∫—É
    $enhancedScript = @"
function $Command {
$proxyScript
}
"@

    if ($OutputScript)
    {
        $enhancedScript | Out-File -FilePath $OutputScript -Encoding UTF8
        Write-Status -Success "Proxy —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤: $OutputScript"
    }

    if ($PassThru)
    {
        return $enhancedScript
    }
}

#endregion

#region –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –∫–æ–º–∞–Ω–¥

function Explore-Command
{
    <#
    .SYNOPSIS
        –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π PowerShell –∫–æ–º–∞–Ω–¥

    .DESCRIPTION
        –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑—É—á–∏—Ç—å –ª—é–±—É—é –∫–æ–º–∞–Ω–¥—É –∏–∑–Ω—É—Ç—Ä–∏, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ
        –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –º–µ—Ç–æ–¥—ã –∏ —Å–æ–∑–¥–∞—Ç—å —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
    #>
    [CmdletBinding()]
    param(
        [Parameter(Mandatory)]
        [string]$Name
    )

    Clear-Host
    Write-GradientHeader -Title "COMMAND EXPLORER: $Name"

    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    $command = Get-Command $Name -ErrorAction Stop
    $help = Microsoft.PowerShell.Core\Get-Help $Name -Full

    wrgb "`nüìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:" -FC "Cyan" -Style Bold -newline
    wrgb "  –¢–∏–ø: " -FC "Gray"
    wrgb $command.CommandType -FC "Yellow" -newline
    wrgb "  –ú–æ–¥—É–ª—å: " -FC "Gray"
    wrgb $command.ModuleName -FC "Material_Purple" -newline
    wrgb "  –í–µ—Ä—Å–∏—è: " -FC "Gray"
    wrgb $command.Version -FC "Material_Green" -newline

    # –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –∫–æ–º–∞–Ω–¥–µ
    wrgb "  –ü–æ–ª–Ω–æ–µ –∏–º—è: " -FC "Gray"
    wrgb "$( $command.ModuleName )\$( $command.Name )" -FC "Material_Orange" -newline

    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
    wrgb "`nüìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:" -FC "Cyan" -Style Bold -newline
    $command.Parameters.Values | ForEach-Object {
        wrgb "  ‚Ä¢ " -FC "DarkGray"
        wrgb "-$( $_.Name )" -FC "Material_Cyan"
        wrgb " [$( $_.ParameterType.Name )]" -FC "Material_Purple"

        if ($_.IsMandatory)
        {
            wrgb " (–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)" -FC "Red"
        }

        Write-Host ""
    }

    # –ù–∞–±–æ—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if ($command.ParameterSets.Count -gt 1)
    {
        wrgb "`nüîÄ –ù–∞–±–æ—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:" -FC "Cyan" -Style Bold -newline
        $command.ParameterSets | ForEach-Object {
            wrgb "  ‚Ä¢ " -FC "DarkGray"
            wrgb $_.Name -FC "Material_Yellow"
            if ($_.IsDefault)
            {
                wrgb " (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é)" -FC "Green"
            }
            Write-Host ""
        }
    }

    # –ü—Ä–∏–º–µ—Ä—ã –≤—ã–∑–æ–≤–æ–≤
    wrgb "`nüí° –°–ø–æ—Å–æ–±—ã –≤—ã–∑–æ–≤–∞:" -FC "Cyan" -Style Bold -newline

    # –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤
    wrgb "  1. –û–±—ã—á–Ω—ã–π: " -FC "Gray"
    wrgb $Name -FC "White" -newline

    # –ß–µ—Ä–µ–∑ –º–æ–¥—É–ª—å
    if ($command.ModuleName)
    {
        wrgb "  2. –ß–µ—Ä–µ–∑ –º–æ–¥—É–ª—å: " -FC "Gray"
        wrgb "$( $command.ModuleName )\$Name" -FC "White" -newline
    }

    # –ü–æ–ª–Ω—ã–π –ø—É—Ç—å
    wrgb "  3. –ü–æ–ª–Ω—ã–π –ø—É—Ç—å: " -FC "Gray"
    wrgb "Microsoft.PowerShell.$( $command.ModuleName )\$Name" -FC "White" -newline

    # –°–æ–∑–¥–∞–Ω–∏–µ proxy
    wrgb "`nüîß –î–µ–π—Å—Ç–≤–∏—è:" -FC "Cyan" -Style Bold -newline
    wrgb "  [P] –°–æ–∑–¥–∞—Ç—å Proxy-—Ñ—É–Ω–∫—Ü–∏—é" -FC "Yellow" -newline
    wrgb "  [T] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã" -FC "Yellow" -newline
    wrgb "  [E] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é" -FC "Yellow" -newline
    wrgb "  [Q] –í—ã—Ö–æ–¥" -FC "Red" -newline

    wrgb "`n–í—ã–±–æ—Ä: " -FC "White"
    $choice = Read-Host

    switch ( $choice.ToUpper())
    {
        'P' {
            wrgb "`n–ò–º—è –¥–ª—è proxy-—Ñ—É–Ω–∫—Ü–∏–∏: " -FC "Cyan"
            $proxyName = Read-Host

            if ($proxyName)
            {
                New-CommandProxy -Command $Name -OutputScript "$proxyName.ps1" -AddParameters @{
                    Enhanced = @{
                        Type = 'switch'; Help = '–í–∫–ª—é—á–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏—è'
                    }
                    ColorOutput = @{
                        Type = 'switch'; Help = '–¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥'
                    }
                }
            }
        }
        'T' {
            Test-CommandCalls -CommandName $Name
        }
        'E' {
            $exportData = @{
                Command = $command
                Help = $help
                Parameters = $command.Parameters
                ParameterSets = $command.ParameterSets
            }

            $exportPath = "$env:TEMP\$Name`_info.json"
            $exportData | ConvertTo-Json -Depth 10 | Out-File $exportPath
            Write-Status -Success "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤: $exportPath"
        }
    }
}

function Test-CommandCalls
{
    param([string]$CommandName)

    wrgb "`nüß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –≤—ã–∑–æ–≤–∞:" -FC "Cyan" -Style Bold -newline

    # –¢–µ—Å—Ç 1: –û–±—ã—á–Ω—ã–π –≤—ã–∑–æ–≤
    wrgb "`n1. –û–±—ã—á–Ω—ã–π –≤—ã–∑–æ–≤:" -FC "Yellow" -newline
    try
    {
        $result1 = & $CommandName -ErrorAction Stop
        Write-Status -Success "–£—Å–ø–µ—à–Ω–æ"
    }
    catch
    {
        Write-Status -Error $_.Exception.Message
    }

    # –¢–µ—Å—Ç 2: –ß–µ—Ä–µ–∑ –º–æ–¥—É–ª—å
    $cmd = Get-Command $CommandName
    if ($cmd.ModuleName)
    {
        wrgb "`n2. –ß–µ—Ä–µ–∑ –º–æ–¥—É–ª—å:" -FC "Yellow" -newline
        try
        {
            $result2 = & "$( $cmd.ModuleName )\$CommandName" -ErrorAction Stop
            Write-Status -Success "–£—Å–ø–µ—à–Ω–æ"
        }
        catch
        {
            Write-Status -Error $_.Exception.Message
        }
    }

    # –¢–µ—Å—Ç 3: –ü–æ–ª–Ω—ã–π –ø—É—Ç—å
    wrgb "`n3. –ü–æ–ª–Ω—ã–π –ø—É—Ç—å:" -FC "Yellow" -newline
    try
    {
        $fullPath = "Microsoft.PowerShell.$( $cmd.ModuleName )\$CommandName"
        $result3 = & $fullPath -ErrorAction Stop
        Write-Status -Success "–£—Å–ø–µ—à–Ω–æ"
    }
    catch
    {
        Write-Status -Error $_.Exception.Message
    }
}

#endregion

#region –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

function Show-ProxyTechniquesDemo
{
    Clear-Host
    Write-GradientHeader -Title "PROXY TECHNIQUES DEMONSTRATION"

    wrgb "üîÆ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–æ—â–∏ —Ç–µ—Ö–Ω–∏–∫–∏ Microsoft.PowerShell.Core\Command" -FC "GoldRGB" -Style Bold -newline

    # –î–µ–º–æ 1: –£–ª—É—á—à–µ–Ω–Ω—ã–π Get-Help
    wrgb "`n1Ô∏è‚É£ –£–ª—É—á—à–µ–Ω–Ω—ã–π Get-Help —Å —Ü–≤–µ—Ç–∞–º–∏:" -FC "Cyan" -newline
    wrgb "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: " -FC "Gray"
    wrgb "Get-Help Get-Process" -FC "Yellow" -Style Bold -newline

    # –î–µ–º–æ 2: –¶–≤–µ—Ç–Ω–æ–π Get-Process
    wrgb "`n2Ô∏è‚É£ Get-Process —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π:" -FC "Cyan" -newline
    wrgb "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: " -FC "Gray"
    wrgb "Get-Process -ColorByUsage" -FC "Yellow" -Style Bold -newline

    # –î–µ–º–æ 3: Get-ChildItem —Å –∏–∫–æ–Ω–∫–∞–º–∏
    wrgb "`n3Ô∏è‚É£ Get-ChildItem —Å –∏–∫–æ–Ω–∫–∞–º–∏ —Ñ–∞–π–ª–æ–≤:" -FC "Cyan" -newline
    wrgb "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: " -FC "Gray"
    wrgb "Get-ChildItem -ColorByType" -FC "Yellow" -Style Bold -newline

    # –î–µ–º–æ 4: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥
    wrgb "`n4Ô∏è‚É£ –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –∫–æ–º–∞–Ω–¥:" -FC "Cyan" -newline
    wrgb "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: " -FC "Gray"
    wrgb "Explore-Command Get-Service" -FC "Yellow" -Style Bold -newline

    wrgb "`nüí° –≠—Ç–∞ —Ç–µ—Ö–Ω–∏–∫–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:" -FC "Material_Orange" -Style Bold -newline
    wrgb "  ‚Ä¢ –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã" -FC "White" -newline
    wrgb "  ‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª" -FC "White" -newline
    wrgb "  ‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å" -FC "White" -newline
    wrgb "  ‚Ä¢ –°–æ–∑–¥–∞–≤–∞—Ç—å —É–º–Ω—ã–µ –æ–±–µ—Ä—Ç–∫–∏" -FC "White" -newline

    wrgb "`nüéØ –ö–ª—é—á–µ–≤–∞—è —Å—Ç—Ä–æ–∫–∞:" -FC "Red" -Style Bold -newline
    wrgb "  Microsoft.PowerShell.Core\Get-Help @PSBoundParameters" -FC "Material_Yellow" -BC "#1E1E1E" -newline

    wrgb "`n–≠—Ç–æ –∫–∞–∫ '—Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤' - –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ!" -FC "Gray" -newline
}

#endregion

# –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
if ($MyInvocation.MyCommand.Path -match '\.psm1$')
{
    Export-ModuleMember -Function * -Alias *
}

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
wrgb "`nüîÆ " -FC "GoldRGB"
Write-GradientText "Advanced Proxy Techniques" -StartColor "#FF00FF" -EndColor "#00FFFF" -NoNewline
wrgb " –∑–∞–≥—Ä—É–∂–µ–Ω—ã!" -FC "GoldRGB" -newline

wrgb "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: " -FC "Gray"
wrgb "Show-ProxyTechniquesDemo" -FC "Material_Pink" -Style Bold
wrgb " –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏" -FC "Gray" -newline


# ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
# ‚ïë                    üßô‚Äç‚ôÇÔ∏è SUPER ADVANCED PROXY MAGIC                           ‚ïë
# ‚ïë                   –ì–ª—É–±–æ–∫–∞—è –º–∞–≥–∏—è PowerShell –ø—Ä–æ–∫—Å–∏-–∫–æ–º–∞–Ω–¥                   ‚ïë
# ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

#region –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ –í–°–ï–• –∫–æ–º–∞–Ω–¥

function Enable-UniversalCommandInterceptor
{
    <#
    .SYNOPSIS
        –í–∫–ª—é—á–∞–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ –¥–ª—è –í–°–ï–• –∫–æ–º–∞–Ω–¥ PowerShell

    .DESCRIPTION
        –°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã –≤ —Å–∏—Å—Ç–µ–º–µ, –ø–æ–∑–≤–æ–ª—è—è –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å,
        –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏ —É–ª—É—á—à–∞—Ç—å –ª—é–±—ã–µ –≤—ã–∑–æ–≤—ã

    .EXAMPLE
        Enable-UniversalCommandInterceptor -LogCalls -ColorOutput
    #>
    [CmdletBinding()]
    param(
        [switch]$LogCalls,
        [switch]$ColorOutput,
        [switch]$MeasurePerformance,
        [switch]$SafeMode, # –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
        [string[]]$IncludeCommand = @(),
        [string[]]$ExcludeCommand = @()
    )

    $script:InterceptorConfig = @{
        LogCalls = $LogCalls
        ColorOutput = $ColorOutput
        MeasurePerformance = $MeasurePerformance
        SafeMode = $SafeMode
        CallLog = @()
    }

    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
    $commands = Get-Command -CommandType Cmdlet, Function

    if ($IncludeCommand) {
        $commands = $commands | Where-Object {
            $_.Name -in $IncludeCommand
        }
    }

    if ($ExcludeCommand)
    {
        $commands = $commands | Where-Object {
            $_.Name -notin $ExcludeCommand
        }
    }

    $intercepted = 0
    foreach ($cmd in $commands)
    {
        try
        {
            # –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
            $originalName = "__Original_$( $cmd.Name )"

            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
            if (-not (Get-Command $originalName -ErrorAction SilentlyContinue))
            {
                Set-Alias -Name $originalName -Value "$( $cmd.ModuleName )\$( $cmd.Name )" -Scope Global
            }

            # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–∫—Å–∏
            $proxyDefinition = @"
function global:$( $cmd.Name ) {
    [CmdletBinding()]
    param()

    dynamicparam {
        # –ü–æ–ª—É—á–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        `$wrappedCmd = Get-Command $originalName
        `$metadata = [System.Management.Automation.CommandMetadata]::new(`$wrappedCmd)
        `$dynamicParams = [System.Management.Automation.RuntimeDefinedParameterDictionary]::new()

        foreach (`$param in `$metadata.Parameters.Values) {
            `$dynParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                `$param.Name,
                `$param.ParameterType,
                `$param.Attributes
            )
            `$dynamicParams.Add(`$param.Name, `$dynParam)
        }

        return `$dynamicParams
    }

    begin {
        `$startTime = Get-Date

        if (`$script:InterceptorConfig.LogCalls) {
            `$script:InterceptorConfig.CallLog += @{
                Command = '$( $cmd.Name )'
                Time = `$startTime
                Parameters = `$PSBoundParameters
            }
        }

        if (`$script:InterceptorConfig.SafeMode) {
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
            `$dangerous = @('Remove-Item', 'Clear-Content', 'Stop-Process', 'Stop-Computer', 'Restart-Computer')
            if ('$( $cmd.Name )' -in `$dangerous) {
                Write-Warning "–ö–æ–º–∞–Ω–¥–∞ '$( $cmd.Name )' –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ä–µ–∂–∏–º–µ!"
                return
            }
        }
    }

    process {
        # –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
        & $originalName @PSBoundParameters
    }

    end {
        if (`$script:InterceptorConfig.MeasurePerformance) {
            `$duration = (Get-Date) - `$startTime
            Write-Host "‚è±Ô∏è $( $cmd.Name ): `$(`$duration.TotalMilliseconds)ms" -ForegroundColor DarkGray
        }
    }
}
"@

            # –í—ã–ø–æ–ª–Ω—è–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏
            Invoke-Expression $proxyDefinition
            $intercepted++

        }
        catch
        {
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–∂–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å
            continue
        }
    }

    Write-Status -Success "–ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ –∫–æ–º–∞–Ω–¥: $intercepted"
}

function Disable-UniversalCommandInterceptor
{
    <#
    .SYNOPSIS
        –û—Ç–∫–ª—é—á–∞–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥
    #>

    # –ó–¥–µ—Å—å –Ω—É–∂–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
    Write-Status -Warning "–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Å—Å–∏–∏ PowerShell"
}

function Show-InterceptedCalls
{
    <#
    .SYNOPSIS
        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∂—É—Ä–Ω–∞–ª –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
    #>

    if (-not $script:InterceptorConfig -or $script:InterceptorConfig.CallLog.Count -eq 0) {
    Write-Status -Info "–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –≤—ã–∑–æ–≤–∞—Ö"
    return
    }

    Write-GradientHeader -Title "INTERCEPTED CALLS LOG"

    $script:InterceptorConfig.CallLog | ForEach-Object {
    wrgb "[$($_.Time.ToString('HH:mm:ss'))] " -FC "DarkGray"
    wrgb $_.Command -FC "Material_Yellow" -Style Bold

    if ($_.Parameters.Count -gt 0) {
    wrgb " -" -FC "Material_Cyan"
    $_.Parameters.GetEnumerator() | ForEach-Object {
    wrgb "$($_.Key):" -FC "Material_Purple"
    wrgb "$($_.Value) " -FC "White"
    }
    }
    Write-Host ""
    }
}

#endregion

#region –£–º–Ω—ã–π Help System —Å AI-–ø–æ–¥–æ–±–Ω—ã–º–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏

function Get-SmartHelp
{
    <#
    .SYNOPSIS
        –°—É–ø–µ—Ä-—É–º–Ω—ã–π Help —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏, –ø–æ—Ö–æ–∂–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
    #>
    [CmdletBinding()]
    param(
        [Parameter(Position = 0)]
        [string]$Name,

        [switch]$ShowSimilar,
        [switch]$ShowUsageStats,
        [switch]$Interactive,
        [switch]$GenerateExamples
    )

    # –ï—Å–ª–∏ –∏–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é
    if (-not $Name)
    {
        Show-InteractiveHelpMenu
        return
    }

    # –ü–æ–ª—É—á–∞–µ–º help —á–µ—Ä–µ–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
    $help = Microsoft.PowerShell.Core\Get-Help $Name -ErrorAction SilentlyContinue

    if (-not $help)
    {
        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ –∫–æ–º–∞–Ω–¥—ã
        Write-Status -Warning "–ö–æ–º–∞–Ω–¥–∞ '$Name' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

        $similar = Get-Command -Name "*$Name*" -ErrorAction SilentlyContinue | Select-Object -First 5
        if ($similar)
        {
            wrgb "`n–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏—Å–∫–∞–ª–∏:" -FC "Cyan" -newline
            $similar | ForEach-Object {
                wrgb "  ‚Ä¢ " -FC "DarkGray"
                wrgb $_.Name -FC "Material_Yellow"
                wrgb " - " -FC "DarkGray"
                $synopsis = (Microsoft.PowerShell.Core\Get-Help $_.Name).Synopsis
                wrgb ($synopsis -split "`n")[0] -FC "Gray" -newline
            }
        }
        return
    }

    # –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ help
    Clear-Host
    Write-GradientHeader -Title "SMART HELP: $( $help.Name )" -StartColor "#4ECDC4" -EndColor "#44A08D"

    # –°–∏–Ω–æ–ø—Å–∏—Å —Å —ç–º–æ–¥–∑–∏
    if ($help.Synopsis)
    {
        wrgb "üìã " -FC "Cyan"
        wrgb "–ö–†–ê–¢–ö–û–ï –û–ü–ò–°–ê–ù–ò–ï" -FC "Material_Pink" -Style Bold -newline
        wrgb "   $( $help.Synopsis )" -FC "White" -newline
    }

    # –°–∏–Ω—Ç–∞–∫—Å–∏—Å —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
    if ($help.Syntax)
    {
        wrgb "`n‚ö° " -FC "Yellow"
        wrgb "–°–ò–ù–¢–ê–ö–°–ò–°" -FC "Material_Pink" -Style Bold -newline

        $help.Syntax.syntaxItem | ForEach-Object {
            wrgb "   " -FC "White"
            wrgb $_.name -FC "Material_Yellow" -Style Bold

            $_.parameter | ForEach-Object {
                if ($_.required -eq "true")
                {
                    wrgb " -$( $_.name )" -FC "Material_Red" -Style Bold
                }
                else
                {
                    wrgb " [-$( $_.name )]" -FC "Material_Cyan"
                }

                if ($_.parameterValue)
                {
                    wrgb " <$( $_.parameterValue )>" -FC "Material_Purple"
                }
            }
            Write-Host ""
        }
    }

    # –£–º–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
    if ($GenerateExamples -or $help.examples)
    {
        wrgb "`nüí° " -FC "Green"
        wrgb "–ü–†–ò–ú–ï–†–´" -FC "Material_Pink" -Style Bold -newline

        if ($help.examples)
        {
            $exampleCount = 1
            $help.examples.example | ForEach-Object {
                wrgb "`n   –ü—Ä–∏–º–µ—Ä $exampleCount`: " -FC "Material_Orange" -Style Bold
                wrgb $_.title -FC "Gray" -newline

                # –ö–æ–¥ –ø—Ä–∏–º–µ—Ä–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
                wrgb "   PS> " -FC "DarkCyan"
                $_.code | Out-ParsedPowerShell

                if ($_.remarks)
                {
                    wrgb "   " -FC "White"
                    wrgb ($_.remarks | Out-String).Trim() -FC "Gray" -newline
                }

                $exampleCount++
            }
        }

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–º–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
        if ($GenerateExamples)
        {
            wrgb "`n   ü§ñ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:" -FC "Material_Green" -newline
            Generate-SmartExamples -CommandName $help.Name
        }
    }

    # –ü–æ—Ö–æ–∂–∏–µ –∫–æ–º–∞–Ω–¥—ã
    if ($ShowSimilar)
    {
        wrgb "`nüîó " -FC "Blue"
        wrgb "–ü–û–•–û–ñ–ò–ï –ö–û–ú–ê–ù–î–´" -FC "Material_Pink" -Style Bold -newline

        Find-SimilarCommands -CommandName $help.Name | ForEach-Object {
            wrgb "   ‚Ä¢ " -FC "DarkGray"
            wrgb $_.Name -FC "Material_Cyan"
            wrgb " - " -FC "DarkGray"
            wrgb $_.Synopsis -FC "Gray" -newline
        }
    }

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    if ($ShowUsageStats)
    {
        Show-CommandUsageStats -CommandName $help.Name
    }

    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    if ($Interactive)
    {
        Show-InteractiveHelp -HelpObject $help
    }
}

function Generate-SmartExamples
{
    param([string]$CommandName)

    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥—ã
    $command = Get-Command $CommandName -ErrorAction SilentlyContinue
    if (-not $command)
    {
        return
    }

    # –ü—Ä–∏–º–µ—Ä: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    $examples = @()

    # –ü—Ä–∏–º–µ—Ä —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    $mandatoryParams = $command.Parameters.Values | Where-Object {
        $_.IsMandatory
    }
    if ($mandatoryParams)
    {
        $example = "$CommandName"
        foreach ($param in $mandatoryParams)
        {
            $example += " -$( $param.Name ) "
            $example += switch ($param.ParameterType.Name)
            {
                'String' {
                    '"example"'
                }
                'Int32' {
                    '42'
                }
                'Boolean' {
                    '$true'
                }
                'DateTime' {
                    '(Get-Date)'
                }
                default {
                    '<value>'
                }
            }
        }
        wrgb "   $example" -FC "Yellow" -newline
    }

    # –ü—Ä–∏–º–µ—Ä —Å pipeline
    if ($command.Parameters.Values | Where-Object {
        $_.ValueFromPipeline
    })
    {
        wrgb "   Get-Something | $CommandName" -FC "Yellow" -newline
    }
}

function Find-SimilarCommands
{
    param([string]$CommandName)

    $command = Get-Command $CommandName -ErrorAction SilentlyContinue
    if (-not $command)
    {
        return
    }

    # –ò—â–µ–º –∫–æ–º–∞–Ω–¥—ã –≤ —Ç–æ–º –∂–µ –º–æ–¥—É–ª–µ
    if ($command.ModuleName)
    {
        Get-Command -Module $command.ModuleName |
                Where-Object {
                    $_.Name -ne $CommandName
                } |
                Select-Object -First 5 Name, @{
                    Name = 'Synopsis'
                    Expression = {
                        (Microsoft.PowerShell.Core\Get-Help $_.Name).Synopsis
                    }
                }
    }

    # –ò—â–µ–º –∫–æ–º–∞–Ω–¥—ã —Å –ø–æ—Ö–æ–∂–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
    $verb = $command.Name -split '-' | Select-Object -First 1
    Get-Command -Verb $verb |
            Where-Object {
                $_.Name -ne $CommandName
            } |
            Select-Object -First 3 Name, @{
                Name = 'Synopsis'
                Expression = {
                    (Microsoft.PowerShell.Core\Get-Help $_.Name).Synopsis
                }
            }
}

function Show-InteractiveHelp
{
    param($HelpObject)

    $running = $true
    while ($running)
    {
        wrgb "`nüìö –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞" -FC "Cyan" -Style Bold -newline
        wrgb "[P] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥—Ä–æ–±–Ω–æ" -FC "Yellow" -newline
        wrgb "[E] –ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤" -FC "Yellow" -newline
        wrgb "[S] –ü–æ—Ö–æ–∂–∏–µ –∫–æ–º–∞–Ω–¥—ã" -FC "Yellow" -newline
        wrgb "[T] –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É" -FC "Yellow" -newline
        wrgb "[Q] –í—ã—Ö–æ–¥" -FC "Red" -newline

        wrgb "`n–í—ã–±–æ—Ä: " -FC "White"
        $choice = Read-Host

        switch ( $choice.ToUpper())
        {
            'P' {
                Show-DetailedParameters -Command $HelpObject.Name
            }
            'E' {
                Search-OnlineExamples -Command $HelpObject.Name
            }
            'S' {
                Find-SimilarCommands -CommandName $HelpObject.Name | Format-Table
            }
            'T' {
                Test-CommandInteractive -CommandName $HelpObject.Name
            }
            'Q' {
                $running = $false
            }
        }
    }
}

#endregion

#region –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ä–∞–±–æ—Ç–∞ —Å –º–æ–¥—É–ª—è–º–∏

function Get-ModuleInternals
{
    <#
    .SYNOPSIS
        –ò—Å—Å–ª–µ–¥—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ PowerShell –º–æ–¥—É–ª—è

    .DESCRIPTION
        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    #>
    param(
        [Parameter(Mandatory)]
        [string]$ModuleName,

        [switch]$ShowHidden,
        [switch]$ShowPrivate,
        [switch]$ExportDiagram
    )

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å –µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
    if (-not (Get-Module $ModuleName))
    {
        Import-Module $ModuleName -ErrorAction Stop
    }

    $module = Get-Module $ModuleName

    Write-GradientHeader -Title "MODULE INTERNALS: $ModuleName"

    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    wrgb "üì¶ –ú–æ–¥—É–ª—å: " -FC "Cyan"
    wrgb $module.Name -FC "White" -Style Bold
    wrgb " v$( $module.Version )" -FC "Gray" -newline

    # –í—Å–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
    wrgb "`nüì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:" -FC "Cyan" -Style Bold -newline
    $module.ExportedCommands.Values | Group-Object CommandType | ForEach-Object {
        wrgb "  $( $_.Name ): " -FC "Material_Purple"
        wrgb $_.Count -FC "Yellow" -Style Bold -newline
    }

    # –°–∫—Ä—ã—Ç—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    if ($ShowHidden -or $ShowPrivate)
    {
        wrgb "`nüîí –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:" -FC "Cyan" -Style Bold -newline

        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω –º–æ–¥—É–ª—è
        $moduleScope = & $module {
            $ExecutionContext.SessionState.Module
        }
        $allFunctions = & $moduleScope {
            Get-Command -CommandType Function
        }

        $privateFunctions = $allFunctions | Where-Object {
            $_.Name -notin $module.ExportedCommands.Keys
        }

        if ($privateFunctions)
        {
            wrgb "  –ù–∞–π–¥–µ–Ω–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π: " -FC "Gray"
            wrgb $privateFunctions.Count -FC "Red" -Style Bold -newline

            $privateFunctions | Select-Object -First 10 | ForEach-Object {
                wrgb "  ‚Ä¢ " -FC "DarkGray"
                wrgb $_.Name -FC "Material_Red"

                # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
                $ast = $_.ScriptBlock.Ast
                if ($ast.Body.ParamBlock -and $ast.Body.ParamBlock.Attributes)
                {
                    $comment = $ast.GetHelpContent()
                    if ($comment.Synopsis)
                    {
                        wrgb " - " -FC "DarkGray"
                        wrgb $comment.Synopsis -FC "Gray"
                    }
                }
                Write-Host ""
            }
        }
    }

    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª—è
    wrgb "`nüìä –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª—è:" -FC "Cyan" -Style Bold -newline
    $moduleVariables = & $module {
        Get-Variable -Scope Script
    }

    $moduleVariables | Select-Object -First 10 | ForEach-Object {
        wrgb "  ‚Ä¢ " -FC "DarkGray"
        wrgb "`$$( $_.Name )" -FC "Material_Green"
        wrgb " = " -FC "Gray"

        $value = if ($_.Value -is [string] -and $_.Value.Length -gt 50)
        {
            $_.Value.Substring(0, 50) + "..."
        }
        else
        {
            $_.Value
        }

        wrgb $value -FC "White" -newline
    }

    # –°–æ–∑–¥–∞–µ–º –¥–∏–∞–≥—Ä–∞–º–º—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    if ($ExportDiagram)
    {
        Export-ModuleDiagram -Module $module
    }
}

function Invoke-HiddenCommand
{
    <#
    .SYNOPSIS
        –í—ã–∑—ã–≤–∞–µ—Ç —Å–∫—Ä—ã—Ç—É—é/–ø—Ä–∏–≤–∞—Ç–Ω—É—é –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–æ–¥—É–ª—è

    .DESCRIPTION
        –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—è
    #>
    param(
        [Parameter(Mandatory)]
        [string]$ModuleName,

        [Parameter(Mandatory)]
        [string]$CommandName,

        [Parameter(ValueFromRemainingArguments)]
        $Arguments
    )

    $module = Get-Module $ModuleName -ErrorAction Stop

    # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –º–æ–¥—É–ª—è
    & $module $CommandName @Arguments
}

#endregion

#region –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–æ–º–∞–Ω–¥

$script:CommandMonitor = @{
    Enabled = $false
    History = @()
    Statistics = @{
    }
}

function Start-CommandMonitor
{
    <#
    .SYNOPSIS
        –ó–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∫–æ–º–∞–Ω–¥
    #>
    param(
        [switch]$TrackParameters,
        [switch]$TrackPerformance,
        [switch]$TrackErrors,
        [switch]$ShowLiveStats
    )

    $script:CommandMonitor.Enabled = $true

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ PreCommandLookupAction
    $ExecutionContext.InvokeCommand.PreCommandLookupAction = {
        param($CommandName, $CommandLookupEventArgs)

        if ($script:CommandMonitor.Enabled)
        {
            $entry = @{
                Command = $CommandName
                Time = Get-Date
                SessionId = [Guid]::NewGuid()
            }

            $script:CommandMonitor.History += $entry

            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            if (-not $script:CommandMonitor.Statistics.ContainsKey($CommandName)) {
            $script:CommandMonitor.Statistics[$CommandName] = @{
            Count = 0
            TotalTime = [TimeSpan]::Zero
            Errors = 0
            }
            }

            $script:CommandMonitor.Statistics[$CommandName].Count++

            if ($ShowLiveStats) {
            Write-Host "‚Üí $CommandName" -ForegroundColor DarkGray
            }
        }
    }

    Write-Status -Success "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ –∑–∞–ø—É—â–µ–Ω"
}

function Stop-CommandMonitor
{
    $script:CommandMonitor.Enabled = $false
    $ExecutionContext.InvokeCommand.PreCommandLookupAction = $null
    Write-Status -Info "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
}

function Show-CommandStatistics
{
    <#
    .SYNOPSIS
        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥
    #>
    param(
        [switch]$Top10,
        [switch]$GroupByVerb,
        [switch]$ShowGraph
    )

    if ($script:CommandMonitor.Statistics.Count -eq 0)
    {
        Write-Status -Warning "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"
        return
    }

    Write-GradientHeader -Title "COMMAND USAGE STATISTICS"

    $stats = $script:CommandMonitor.Statistics.GetEnumerator() |
    Sort-Object {
    $_.Value.Count
    } -Descending

    if ($Top10) {
    $stats = $stats | Select-Object -First 10
    }

    wrgb "üìä –¢–æ–ø –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–∞–Ω–¥:" -FC "Cyan" -Style Bold -newline

    $maxCount = ($stats | Measure-Object {
    $_.Value.Count
    } -Maximum).Maximum

    foreach ($stat in $stats) {
    $percentage = ($stat.Value.Count / $maxCount) * 100
    $barLength = [Math]::Round($percentage / 5)

    wrgb ("  " + $stat.Key.PadRight(30)) -FC "Material_Yellow"

    # –ì—Ä–∞—Ñ–∏–∫
    for ($i = 0; $i -lt $barLength; $i++) {
    wrgb "‚ñà" -FC (Get-ProgressGradientColor -Percent $percentage)
    }

    wrgb " $($stat.Value.Count)" -FC "White" -Style Bold -newline
    }

    if ($GroupByVerb) {
    wrgb "`nüìà –ü–æ –≥–ª–∞–≥–æ–ª–∞–º:" -FC "Cyan" -Style Bold -newline

    $verbStats = $stats | ForEach-Object {
    $verb = ($_.Key -split '-')[0]
    @{
    Verb = $verb; Count = $_.Value.Count
    }
    } | Group-Object Verb | ForEach-Object {
    @{
    Verb = $_.Name
    Total = ($_.Group | Measure-Object Count -Sum).Sum
    }
    } | Sort-Object Total -Descending

    $verbStats | ForEach-Object {
    wrgb "  $($_.Verb): " -FC "Material_Purple"
    wrgb $_.Total -FC "Yellow" -Style Bold -newline
    }
    }
}

#endregion

#region –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

function Show-UltimateProxyDemo
{
    Clear-Host

    "üßô‚Äç‚ôÇÔ∏è ULTIMATE PROXY MAGIC DEMO üßô‚Äç‚ôÇÔ∏è" | Write-Rainbow -Mode Gradient -Style Neon -Animated

    wrgb "`n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –≥–ª—É–±–æ–∫–æ–π –º–∞–≥–∏–∏ PowerShell!" -FC "GoldRGB" -Style Bold -newline

    $demos = @(
        @{
            Name = "üéØ Smart Help System"
            Desc = "–£–º–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ —Å AI-–ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏"
            Command = "Get-SmartHelp Get-Process -ShowSimilar -GenerateExamples"
        },
        @{
            Name = "üîç Module Internals Explorer"
            Desc = "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π –º–æ–¥—É–ª–µ–π"
            Command = "Get-ModuleInternals Microsoft.PowerShell.Management -ShowHidden"
        },
        @{
            Name = "üìä Command Monitor"
            Desc = "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥"
            Command = "Start-CommandMonitor -ShowLiveStats; Get-Process; Stop-CommandMonitor; Show-CommandStatistics"
        },
        @{
            Name = "üöÄ Universal Interceptor"
            Desc = "–ü–µ—Ä–µ—Ö–≤–∞—Ç –í–°–ï–• –∫–æ–º–∞–Ω–¥"
            Command = "Enable-UniversalCommandInterceptor -LogCalls -MeasurePerformance"
        }
    )

    wrgb "`nüé™ –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é:" -FC "Cyan" -Style Bold -newline

    for ($i = 0; $i -lt $demos.Count; $i++) {
        $color = Get-MenuGradientColor -Index $i -Total $demos.Count -Style Ocean
        wrgb "  [$( $i + 1 )] " -FC "White"
        wrgb $demos[$i].Name -FC $color -Style Bold
        wrgb " - " -FC "DarkGray"–∫—É
        wrgb $demos[$i].Desc -FC "Gray" -newline
        wrgb "      –ö–æ–º–∞–Ω–¥–∞: " -FC "DarkGray"
        wrgb $demos[$i].Command -FC "Material_Comment" -newline
    }

    wrgb "`nüîë –ö–ª—é—á–µ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞:" -FC "Red" -Style Bold -newline
    wrgb "  Microsoft.PowerShell.Core\Command" -FC "Material_Yellow" -BC "#1E1E1E" -Style Bold -newline
    wrgb "  –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞–ø—Ä—è–º—É—é!" -FC "Gray" -newline

    wrgb "`nüí° –≠—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:" -FC "Material_Orange" -Style Bold -newline
    wrgb "  ‚Ä¢ –ü–µ—Ä–µ—Ö–≤–∞—Ç –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –õ–Æ–ë–´–• –∫–æ–º–∞–Ω–¥" -FC "White" -newline
    wrgb "  ‚Ä¢ –î–æ—Å—Ç—É–ø –∫ —Å–∫—Ä—ã—Ç—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º –º–æ–¥—É–ª–µ–π" -FC "White" -newline
    wrgb "  ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ —É–º–Ω—ã—Ö –æ–±–µ—Ä—Ç–æ–∫ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏" -FC "White" -newline
    wrgb "  ‚Ä¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è" -FC "White" -newline
    wrgb "  ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ AI-–ø–æ–¥–æ–±–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π" -FC "White" -newline

    wrgb "`n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ª—é–±—É—é –∫–æ–º–∞–Ω–¥—É –∏–∑ —Å–ø–∏—Å–∫–∞!" -FC "LimeGreen" -Style Bold -newline
}

#endregion

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
wrgb "`nüßô‚Äç‚ôÇÔ∏è " -FC "GoldRGB"
Write-GradientText "Ultimate Proxy Magic" -StartColor "#9400D3" -EndColor "#FF1493" -NoNewline
wrgb " –∑–∞–≥—Ä—É–∂–µ–Ω–∞!" -FC "Material_LightGreen" -newline

wrgb "–ó–∞–ø—É—Å—Ç–∏—Ç–µ: " -FC "Gray"
wrgb "Show-UltimateProxyDemo" -FC "Material_Pink" -Style Bold
wrgb " –¥–ª—è –ø–æ–ª–Ω–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∏–∏!" -FC "Gray" -newline

# –≠–∫—Å–ø–æ—Ä—Ç
if ($MyInvocation.MyCommand.Path -match '\.psm1$')
{
    Export-ModuleMember -Function * -Alias * -Variable *
}







# ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
# ‚ïë                    üíº PRACTICAL PROXY EXAMPLES                              ‚ïë
# ‚ïë                   –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è proxy —Ç–µ—Ö–Ω–∏–∫–∏                         ‚ïë
# ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

#region –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π Remove-Item —Å –∫–æ—Ä–∑–∏–Ω–æ–π

function Remove-Item
{
    <#
    .SYNOPSIS
        –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –≤–µ—Ä—Å–∏—è Remove-Item —Å –∫–æ—Ä–∑–∏–Ω–æ–π –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

    .DESCRIPTION
        –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç Remove-Item –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç:
        - –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è
        - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏–π
        - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
    #>
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'High')]
    param()

    dynamicparam {
        # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
        $wrappedCmd = Get-Command Remove-Item -Module Microsoft.PowerShell.Management
        $metadata = [System.Management.Automation.CommandMetadata]::new($wrappedCmd)

        # –°–æ–∑–¥–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        $paramDictionary = [System.Management.Automation.RuntimeDefinedParameterDictionary]::new()

        foreach ($param in $metadata.Parameters.Values)
        {
            $dynParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                    $param.Name,
                    $param.ParameterType,
                    $param.Attributes
            )
            $paramDictionary.Add($param.Name, $dynParam)
        }

        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        $trashParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                'UseTrash',
                [switch],
                [System.Management.Automation.ParameterAttribute]@{
                    HelpMessage = '–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è'
                }
        )
        $paramDictionary.Add('UseTrash', $trashParam)

        $skipConfirmParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                'SkipSafetyCheck',
                [switch],
                [System.Management.Automation.ParameterAttribute]@{
                    HelpMessage = '–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏'
                }
        )
        $paramDictionary.Add('SkipSafetyCheck', $skipConfirmParam)

        return $paramDictionary
    }

    begin {
        # –ü—É—Ç—å –∫ –∫–æ—Ä–∑–∏–Ω–µ
        $trashPath = "$env:USERPROFILE\.PowerShellTrash"
        if (-not (Test-Path $trashPath))
        {
            New-Item -Path $trashPath -ItemType Directory -Force | Out-Null
        }

        # –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞—à–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        $useTrash = $PSBoundParameters['UseTrash']
        $skipSafety = $PSBoundParameters['SkipSafetyCheck']

        # –£–±–∏—Ä–∞–µ–º –Ω–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
        $PSBoundParameters.Remove('UseTrash') | Out-Null
        $PSBoundParameters.Remove('SkipSafetyCheck') | Out-Null
    }

    process {
        # –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
        $items = @()
        if ( $PSBoundParameters.ContainsKey('Path'))
        {
            $items = Get-Item -Path $PSBoundParameters['Path'] -ErrorAction SilentlyContinue
        }
        elseif ($PSBoundParameters.ContainsKey('LiteralPath'))
        {
            $items = Get-Item -LiteralPath $PSBoundParameters['LiteralPath'] -ErrorAction SilentlyContinue
        }

        if (-not $skipSafety -and $items)
        {
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
            wrgb "`n‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã:" -FC "Yellow" -Style Bold -newline

            foreach ($item in $items)
            {
                $icon = if ($item.PSIsContainer)
                {
                    "üìÅ"
                }
                else
                {
                    "üìÑ"
                }
                $size = if (-not $item.PSIsContainer)
                {
                    " ({0:N2} MB)" -f ($item.Length / 1MB)
                }
                else
                {
                    $count = (Get-ChildItem $item -Recurse -ErrorAction SilentlyContinue | Measure-Object).Count
                    " ($count —ç–ª–µ–º–µ–Ω—Ç–æ–≤)"
                }

                wrgb "  $icon " -FC "Red"
                wrgb $item.Name -FC "White" -Style Bold
                wrgb $size -FC "DarkGray"
                wrgb " - " -FC "DarkGray"
                wrgb $item.FullName -FC "Gray" -newline
            }

            wrgb "`n" -newline
            $useTrashText = if ($useTrash)
            {
                "(–≤ –∫–æ—Ä–∑–∏–Ω—É)"
            }
            else
            {
                "(–ë–ï–ó–í–û–ó–í–†–ê–¢–ù–û)"
            }
            wrgb "–£–¥–∞–ª–∏—Ç—å " -FC "White"
            wrgb $items.Count -FC "Red" -Style Bold
            wrgb " —ç–ª–µ–º–µ–Ω—Ç(–æ–≤) " -FC "White"
            wrgb $useTrashText -FC $( if ($useTrash)
            {
                "Yellow"
            }
            else
            {
                "Red"
            } ) -Style Bold
            wrgb "? [Y/N]: " -FC "White"

            $confirmation = Read-Host
            if ($confirmation -ne 'Y')
            {
                Write-Status -Warning "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞"
                return
            }
        }

        # –í—ã–ø–æ–ª–Ω—è–µ–º —É–¥–∞–ª–µ–Ω–∏–µ
        foreach ($item in $items)
        {
            try
            {
                if ($useTrash)
                {
                    # –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É
                    $timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
                    $trashName = "$timestamp`_$( $item.Name )"
                    $trashItemPath = Join-Path $trashPath $trashName

                    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                    $metadata = @{
                        OriginalPath = $item.FullName
                        DeletedDate = Get-Date
                        Size = if (-not $item.PSIsContainer)
                        {
                            $item.Length
                        }
                        else
                        {
                            0
                        }
                    }

                    $metadataPath = "$trashItemPath.metadata"
                    $metadata | ConvertTo-Json | Out-File $metadataPath

                    # –ü–µ—Ä–µ–º–µ—â–∞–µ–º
                    Move-Item -Path $item.FullName -Destination $trashItemPath -Force

                    wrgb "  ‚ôªÔ∏è " -FC "Green"
                    wrgb "–ü–µ—Ä–µ–º–µ—â–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É: " -FC "Green"
                    wrgb $item.Name -FC "White" -newline
                }
                else
                {
                    # –û–±—ã—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
                    Microsoft.PowerShell.Management\Remove-Item -Path $item.FullName @PSBoundParameters

                    wrgb "  ‚ùå " -FC "Red"
                    wrgb "–£–¥–∞–ª–µ–Ω–æ: " -FC "Red"
                    wrgb $item.Name -FC "White" -newline
                }

                # –õ–æ–≥–∏—Ä—É–µ–º
                $logEntry = @{
                    Action = if ($useTrash)
                    {
                        "Moved to Trash"
                    }
                    else
                    {
                        "Deleted"
                    }
                    Item = $item.FullName
                    Date = Get-Date
                    User = $env:USERNAME
                }

                $logPath = "$env:TEMP\PowerShell_RemoveItem.log"
                $logEntry | ConvertTo-Json -Compress | Add-Content $logPath

            }
            catch
            {
                Write-Status -Error "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ $( $item.Name ): $_"
            }
        }
    }
}

function Restore-Item
{
    <#
    .SYNOPSIS
        –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ PowerShell –∫–æ—Ä–∑–∏–Ω—ã
    #>
    param(
        [string]$Name,
        [switch]$Latest,
        [switch]$ShowTrash
    )

    $trashPath = "$env:USERPROFILE\.PowerShellTrash"

    if ($ShowTrash)
    {
        Write-GradientHeader -Title "POWERSHELL TRASH"

        $trashItems = Get-ChildItem $trashPath -Filter "*.metadata" | ForEach-Object {
            $metadata = Get-Content $_.FullName | ConvertFrom-Json
            $itemPath = $_.FullName -replace '\.metadata$', ''

            [PSCustomObject]@{
                Name = Split-Path $metadata.OriginalPath -Leaf
                OriginalPath = $metadata.OriginalPath
                DeletedDate = [datetime]$metadata.DeletedDate
                Size = $metadata.Size
                TrashPath = $itemPath
                Exists = Test-Path $itemPath
            }
        } | Sort-Object DeletedDate -Descending

        if ($trashItems)
        {
            $trashItems | ForEach-Object {
                wrgb "üìÑ " -FC $( if ($_.Exists)
                {
                    "Green"
                }
                else
                {
                    "Red"
                } )
                wrgb $_.Name -FC "White" -Style Bold
                wrgb " (—É–¥–∞–ª–µ–Ω–æ: " -FC "DarkGray"
                wrgb $_.DeletedDate.ToString("yyyy-MM-dd HH:mm") -FC "Yellow"
                wrgb ")" -FC "DarkGray" -newline
                wrgb "   –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—É—Ç—å: " -FC "Gray"
                wrgb $_.OriginalPath -FC "Cyan" -newline
            }
        }
        else
        {
            Write-Status -Info "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞"
        }

        return
    }

    # –õ–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...
    Write-Status -Info "–§—É–Ω–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"
}

#endregion

#region –£–º–Ω—ã–π Invoke-WebRequest —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏ retry

function Invoke-WebRequest
{
    [CmdletBinding(HelpUri = 'https://go.microsoft.com/fwlink/?LinkID=217035')]
    param()

    dynamicparam {
        # –ö–æ–ø–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
        $wrappedCmd = Get-Command Invoke-WebRequest -Module Microsoft.PowerShell.Utility
        $metadata = [System.Management.Automation.CommandMetadata]::new($wrappedCmd)
        $paramDictionary = [System.Management.Automation.RuntimeDefinedParameterDictionary]::new()

        foreach ($param in $metadata.Parameters.Values)
        {
            $dynParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                    $param.Name,
                    $param.ParameterType,
                    $param.Attributes
            )
            $paramDictionary.Add($param.Name, $dynParam)
        }

        # –î–æ–±–∞–≤–ª—è–µ–º —É–ª—É—á—à–µ–Ω–∏—è
        $retryParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                'RetryCount',
                [int],
                [System.Management.Automation.ParameterAttribute]@{
                    HelpMessage = '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫'
                }
        )
        $paramDictionary.Add('RetryCount', $retryParam)

        $progressParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                'ShowProgress',
                [switch],
                [System.Management.Automation.ParameterAttribute]@{
                    HelpMessage = '–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å'
                }
        )
        $paramDictionary.Add('ShowProgress', $progressParam)

        return $paramDictionary
    }

    process {
        $retryCount = $PSBoundParameters['RetryCount'] ?? 0
        $showProgress = $PSBoundParameters['ShowProgress'] ?? $false

        # –£–±–∏—Ä–∞–µ–º –Ω–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        $PSBoundParameters.Remove('RetryCount') | Out-Null
        $PSBoundParameters.Remove('ShowProgress') | Out-Null

        $uri = $PSBoundParameters['Uri']
        $attempt = 0
        $success = $false

        while ($attempt -le $retryCount -and -not $success)
        {
            try
            {
                if ($attempt -gt 0)
                {
                    wrgb "üîÑ –ü–æ–ø—ã—Ç–∫–∞ " -FC "Yellow"
                    wrgb "$attempt/$retryCount" -FC "White" -Style Bold
                    wrgb " –¥–ª—è " -FC "Yellow"
                    wrgb $uri -FC "Cyan" -newline
                }

                if ($showProgress -and $PSBoundParameters.ContainsKey('OutFile'))
                {
                    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    $progressPreference = $global:ProgressPreference
                    $global:ProgressPreference = 'SilentlyContinue'

                    $response = Microsoft.PowerShell.Utility\Invoke-WebRequest @PSBoundParameters -PassThru

                    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—à –∫—Ä–∞—Å–∏–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
                    if ($response.Headers['Content-Length'])
                    {
                        $totalSize = [int64]$response.Headers['Content-Length'][0]
                        wrgb "üì• –ó–∞–≥—Ä—É–∑–∫–∞: " -FC "Cyan"
                        wrgb ($totalSize / 1MB).ToString("F2") + " MB" -FC "Yellow" -newline
                    }

                    $global:ProgressPreference = $progressPreference
                    return $response
                }
                else
                {
                    # –û–±—ã—á–Ω—ã–π –≤—ã–∑–æ–≤
                    return Microsoft.PowerShell.Utility\Invoke-WebRequest @PSBoundParameters
                }

                $success = $true

            }
            catch
            {
                $attempt++

                if ($attempt -gt $retryCount)
                {
                    Write-Status -Error "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å–ª–µ $retryCount –ø–æ–ø—ã—Ç–æ–∫: $_"
                    throw
                }
                else
                {
                    Write-Status -Warning "–û—à–∏–±–∫–∞: $_. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã..."
                    Start-Sleep -Seconds 2
                }
            }
        }
    }
}

#endregion

#region Git –∫–æ–º–∞–Ω–¥—ã —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π

function git
{
    <#
    .SYNOPSIS
        –£–ª—É—á—à–µ–Ω–Ω—ã–π git —Å —Ü–≤–µ—Ç–Ω—ã–º –≤—ã–≤–æ–¥–æ–º –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
    #>
    param(
        [Parameter(Position = 0)]
        [string]$Command,

        [Parameter(Position = 1, ValueFromRemainingArguments)]
        [string[]]$Arguments
    )

    # –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–º–∞–Ω–¥
    switch ($Command)
    {
        'status' {
            Write-GradientHeader -Title "GIT STATUS" -StartColor "#F05033" -EndColor "#F79500"

            $output = & git.exe status --porcelain = v1 2> $null

            if (-not $output)
            {
                Write-Status -Success "–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —á–∏—Å—Ç–∞"
            }
            else
            {
                $stats = @{
                    Modified = 0
                    Added = 0
                    Deleted = 0
                    Untracked = 0
                }

                foreach ($line in $output)
                {
                    $status = $line.Substring(0, 2)
                    $file = $line.Substring(3)

                    switch -Wildcard ($status)
                    {
                        '*M*' {
                            wrgb "  üìù " -FC "Yellow"
                            wrgb "–∏–∑–º–µ–Ω–µ–Ω:   " -FC "Yellow"
                            wrgb $file -FC "White" -newline
                            $stats.Modified++
                        }
                        '*A*' {
                            wrgb "  ‚úÖ " -FC "Green"
                            wrgb "–¥–æ–±–∞–≤–ª–µ–Ω:  " -FC "Green"
                            wrgb $file -FC "White" -newline
                            $stats.Added++
                        }
                        '*D*' {
                            wrgb "  ‚ùå " -FC "Red"
                            wrgb "—É–¥–∞–ª–µ–Ω:    " -FC "Red"
                            wrgb $file -FC "White" -newline
                            $stats.Deleted++
                        }
                        '??' {
                            wrgb "  ‚ùì " -FC "Magenta"
                            wrgb "–Ω–µ –æ—Ç—Å–ª–µ–∂: " -FC "Magenta"
                            wrgb $file -FC "White" -newline
                            $stats.Untracked++
                        }
                    }
                }

                # –°–≤–æ–¥–∫–∞
                wrgb "`nüìä –°–≤–æ–¥–∫–∞: " -FC "Cyan"
                if ($stats.Modified -gt 0)
                {
                    wrgb "–∏–∑–º–µ–Ω–µ–Ω–æ: $( $stats.Modified ) " -FC "Yellow"
                }
                if ($stats.Added -gt 0)
                {
                    wrgb "–¥–æ–±–∞–≤–ª–µ–Ω–æ: $( $stats.Added ) " -FC "Green"
                }
                if ($stats.Deleted -gt 0)
                {
                    wrgb "—É–¥–∞–ª–µ–Ω–æ: $( $stats.Deleted ) " -FC "Red"
                }
                if ($stats.Untracked -gt 0)
                {
                    wrgb "–Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è: $( $stats.Untracked ) " -FC "Magenta"
                }
                Write-Host ""
            }
        }

        'log' {
            # –ö—Ä–∞—Å–∏–≤—ã–π –ª–æ–≥ —Å –≥—Ä–∞—Ñ–æ–º
            & git.exe log --graph --pretty = format: '%C(auto)%h%d %s %C(black)%C(bold)%cr' --abbrev-commit @Arguments
        }

        'branch' {
            Write-GradientHeader -Title "GIT BRANCHES" -StartColor "#F05033" -EndColor "#F79500"

            $branches = & git.exe branch -a 2> $null

            foreach ($branch in $branches)
            {
                if ($branch -match '^\*')
                {
                    wrgb "  ‚ûú " -FC "Green" -Style Bold
                    wrgb $branch.Substring(2) -FC "Green" -Style Bold -newline
                }
                elseif ($branch -match 'remotes/')
                {
                    wrgb "  ‚òÅÔ∏è  " -FC "Blue"
                    wrgb $branch.Trim() -FC "Blue" -newline
                }
                else
                {
                    wrgb "  üìå " -FC "White"
                    wrgb $branch.Trim() -FC "White" -newline
                }
            }
        }

        default {
            # –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ - –æ–±—ã—á–Ω—ã–π –≤—ã–∑–æ–≤
            & git.exe $Command @Arguments
        }
    }
}

#endregion

#region –°–∏—Å—Ç–µ–º–∞ –∞–ª–∏–∞—Å–æ–≤ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏

function Set-Alias
{
    <#
    .SYNOPSIS
        –£–ª—É—á—à–µ–Ω–Ω—ã–π Set-Alias —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
    #>
    [CmdletBinding()]
    param()

    dynamicparam {
        $wrappedCmd = Get-Command Set-Alias -Module Microsoft.PowerShell.Utility
        $metadata = [System.Management.Automation.CommandMetadata]::new($wrappedCmd)
        $paramDictionary = [System.Management.Automation.RuntimeDefinedParameterDictionary]::new()

        foreach ($param in $metadata.Parameters.Values)
        {
            $dynParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                    $param.Name,
                    $param.ParameterType,
                    $param.Attributes
            )
            $paramDictionary.Add($param.Name, $dynParam)
        }

        # –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        $autoCompleteParam = [System.Management.Automation.RuntimeDefinedParameter]::new(
                'EnableAutoComplete',
                [switch],
                [System.Management.Automation.ParameterAttribute]@{
                    HelpMessage = '–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –∞–ª–∏–∞—Å–∞'
                }
        )
        $paramDictionary.Add('EnableAutoComplete', $autoCompleteParam)

        return $paramDictionary
    }

    process {
        $enableAutoComplete = $PSBoundParameters['EnableAutoComplete']
        $PSBoundParameters.Remove('EnableAutoComplete') | Out-Null

        # –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É
        Microsoft.PowerShell.Utility\Set-Alias @PSBoundParameters

        # –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
        if ($enableAutoComplete)
        {
            $aliasName = $PSBoundParameters['Name']
            $targetCommand = $PSBoundParameters['Value']

            # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
            Register-ArgumentCompleter -CommandName $aliasName -ScriptBlock {
                param($commandName, $parameterName, $wordToComplete, $commandAst, $fakeBoundParameters)

                # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü–µ–ª–µ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã
                $targetCmd = Get-Command $using:targetCommand -ErrorAction SilentlyContinue
                if ($targetCmd)
                {
                    $targetCmd.Parameters.Keys | Where-Object {
                        $_ -like "$wordToComplete*"
                    } | ForEach-Object {
                        [System.Management.Automation.CompletionResult]::new(
                                "-$_",
                                "-$_",
                                'ParameterName',
                                "Parameter: $_"
                        )
                    }
                }
            }

            Write-Status -Success "–ê–ª–∏–∞—Å '$aliasName' —Å–æ–∑–¥–∞–Ω —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º"
        }
    }
}

#endregion

#region –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤

function Show-PracticalProxyExamples
{
#    Clear-Host

    Write-GradientHeader -Title "PRACTICAL PROXY EXAMPLES" -StartColor "#00C851" -EndColor "#00FF00"

    wrgb "üíº –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è proxy —Ç–µ—Ö–Ω–∏–∫–∏" -FC "GoldRGB" -Style Bold -newline

    wrgb "`n1Ô∏è‚É£ " -FC "Cyan"
    wrgb "–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π Remove-Item" -FC "Yellow" -Style Bold
    wrgb " —Å –∫–æ—Ä–∑–∏–Ω–æ–π:" -FC "White" -newline
    wrgb "   Remove-Item test.txt -UseTrash" -FC "Material_Comment" -newline
    wrgb "   ‚Ä¢ –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω—É –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è" -FC "Gray" -newline
    wrgb "   ‚Ä¢ –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ" -FC "Gray" -newline
    wrgb "   ‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è" -FC "Gray" -newline

    wrgb "`n2Ô∏è‚É£ " -FC "Cyan"
    wrgb "–£–º–Ω—ã–π Invoke-WebRequest" -FC "Yellow" -Style Bold
    wrgb " —Å retry:" -FC "White" -newline
    wrgb "   Invoke-WebRequest https://example.com -RetryCount 3 -ShowProgress" -FC "Material_Comment" -newline
    wrgb "   ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏" -FC "Gray" -newline
    wrgb "   ‚Ä¢ –ö—Ä–∞—Å–∏–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏" -FC "Gray" -newline

    wrgb "`n3Ô∏è‚É£ " -FC "Cyan"
    wrgb "Git —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π" -FC "Yellow" -Style Bold
    wrgb ":" -FC "White" -newline
    wrgb "   git status" -FC "Material_Comment" -newline
    wrgb "   ‚Ä¢ –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ —Å –∏–∫–æ–Ω–∫–∞–º–∏" -FC "Gray" -newline
    wrgb "   ‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π" -FC "Gray" -newline

    wrgb "`n4Ô∏è‚É£ " -FC "Cyan"
    wrgb "Set-Alias —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º" -FC "Yellow" -Style Bold
    wrgb ":" -FC "White" -newline
    wrgb "   Set-Alias gs Get-Service -EnableAutoComplete" -FC "Material_Comment" -newline
    wrgb "   ‚Ä¢ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∞–ª–∏–∞—Å–æ–≤" -FC "Gray" -newline

    wrgb "`nüîë –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:" -FC "Material_Orange" -Style Bold -newline
    wrgb "   ‚úì –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å" -FC "LimeGreen" -newline
    wrgb "   ‚úì –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏" -FC "LimeGreen" -newline
    wrgb "   ‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è" -FC "LimeGreen" -newline
    wrgb "   ‚úì –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏" -FC "LimeGreen" -newline

    wrgb "`nüí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–∏ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã!" -FC "GoldRGB" -Style Bold -newline
}

#endregion

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
wrgb "`nüíº " -FC "GoldRGB"
Write-GradientText "Practical Proxy Examples" -StartColor "#00C851" -EndColor "#00FF00" -NoNewline
wrgb " –∑–∞–≥—Ä—É–∂–µ–Ω—ã!" -FC "Material_LightGreen" -newline

wrgb "–ó–∞–ø—É—Å—Ç–∏—Ç–µ: " -FC "Gray"
wrgb "Show-PracticalProxyExamples" -FC "Material_Pink" -Style Bold
wrgb " –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏" -FC "Gray" -newline

# –≠–∫—Å–ø–æ—Ä—Ç
if ($MyInvocation.MyCommand.Path -match '\.psm1$')
{
    Export-ModuleMember -Function * -Alias * -Variable *
}

Show-PracticalProxyExamples
importProcess  $MyInvocation.MyCommand.Name.trim('.ps1')
